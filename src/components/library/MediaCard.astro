---
import type { CollectionEntry } from "astro:content";
import TierBadge from "./TierBadge.astro";

interface Props {
    item: CollectionEntry<"library">;
}

const { item } = Astro.props;
const { title, coverImage, tier, hotTake, type } = item.data;

// Resolve Creator/Subtitle based on type
let subtitle = "";
let icon = "";

if (type === "book") {
    subtitle = item.data.author;
    icon = "ğŸ“š";
} else if (type === "podcast") {
    subtitle = item.data.podcastName;
    icon = "ğŸ™ï¸";
} else if (type === "video") {
    subtitle = item.data.channel;
    icon = "ğŸ¬";
} else if (type === "article") {
    subtitle = item.data.publication;
    icon = "ğŸ“";
} else if (type === "music") {
    subtitle = `${item.data.artist} â€¢ ${item.data.kind}`;
    icon = "ğŸ§";
}
---

<a
    href={`/library/${item.slug || item.id}`}
    class="group relative block bg-zinc-900 rounded-lg overflow-hidden border border-zinc-800 hover:border-zinc-600 transition-all hover:shadow-xl hover:-translate-y-1"
>
    <div class="aspect-[2/3] relative overflow-hidden bg-zinc-800">
        {
            coverImage ? (
                <img
                    src={coverImage}
                    alt={`Cover of ${title}`}
                    width="600"
                    height="900"
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                    loading="lazy"
                    decoding="async"
                />
            ) : (
                <div class="w-full h-full flex items-center justify-center text-4xl text-zinc-700">
                    {icon}
                </div>
            )
        }

        <div class="absolute top-2 right-2 z-10">
            <TierBadge tier={tier} size="sm" />
        </div>

        <div
            class="absolute top-2 left-2 z-10 bg-black/60 backdrop-blur-sm rounded-full w-8 h-8 flex items-center justify-center text-sm shadow-sm"
        >
            {icon}
        </div>

        <div
            class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-4"
        >
            <p class="text-zinc-200 text-sm italic line-clamp-3">"{hotTake}"</p>
        </div>
    </div>
    <div class="p-3">
        <h3
            class="font-bold text-zinc-100 leading-tight line-clamp-2 mb-1 group-hover:text-blue-400 transition-colors"
        >
            {title}
        </h3>
        <p class="text-zinc-500 text-sm line-clamp-1">{subtitle}</p>
    </div>
</a>
